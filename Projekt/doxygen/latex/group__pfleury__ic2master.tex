\hypertarget{group__pfleury__ic2master}{}\doxysection{I2C Master library}
\label{group__pfleury__ic2master}\index{I2C Master library@{I2C Master library}}


I2C (T\+WI) Master Software Library.  


\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{group__pfleury__ic2master_gab5c0fbe837494c5f9130a5914854250d}{I2\+C\+\_\+\+R\+E\+AD}}~1
\item 
\#define \mbox{\hyperlink{group__pfleury__ic2master_ga9536bf85bced4f4e549a82fb18eb6140}{I2\+C\+\_\+\+W\+R\+I\+TE}}~0
\item 
\#define \mbox{\hyperlink{group__pfleury__ic2master_gad33503cf741851d1bca1d274e9001796}{i2c\+\_\+read}}(ack)~(ack) ? \mbox{\hyperlink{group__pfleury__ic2master_ga32ac22052d55f93375b024192217db21}{i2c\+\_\+read\+Ack}}() \+: \mbox{\hyperlink{group__pfleury__ic2master_gad89e839fc17b05fbb5dd79897c55234e}{i2c\+\_\+read\+Nak}}();
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{group__pfleury__ic2master_ga5730d9445429351b9f750084c5cb5aae}{i2c\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em initialize the I2C master interace. Need to be called only once \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__pfleury__ic2master_gad35d4e4f52ca74b503d5e5e1e0a3f5f3}{i2c\+\_\+stop}} (void)
\begin{DoxyCompactList}\small\item\em Terminates the data transfer and releases the I2C bus. \end{DoxyCompactList}\item 
unsigned char \mbox{\hyperlink{group__pfleury__ic2master_ga58dfadce0c2fee4bfac01df6cd2b4477}{i2c\+\_\+start}} (unsigned char addr)
\begin{DoxyCompactList}\small\item\em Issues a start condition and sends address and transfer direction. \end{DoxyCompactList}\item 
unsigned char \mbox{\hyperlink{group__pfleury__ic2master_ga93a9461da34295250ba935bbce9a980d}{i2c\+\_\+rep\+\_\+start}} (unsigned char addr)
\begin{DoxyCompactList}\small\item\em Issues a repeated start condition and sends address and transfer direction. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__pfleury__ic2master_gaee3747a01738315cd5580588994b6c28}{i2c\+\_\+start\+\_\+wait}} (unsigned char addr)
\begin{DoxyCompactList}\small\item\em Issues a start condition and sends address and transfer direction. \end{DoxyCompactList}\item 
unsigned char \mbox{\hyperlink{group__pfleury__ic2master_gadd947aade44ed6b7f92265f9dec4a711}{i2c\+\_\+write}} (unsigned char data)
\begin{DoxyCompactList}\small\item\em Send one byte to I2C device. \end{DoxyCompactList}\item 
unsigned char \mbox{\hyperlink{group__pfleury__ic2master_ga32ac22052d55f93375b024192217db21}{i2c\+\_\+read\+Ack}} (void)
\begin{DoxyCompactList}\small\item\em read one byte from the I2C device, request more data from device \end{DoxyCompactList}\item 
unsigned char \mbox{\hyperlink{group__pfleury__ic2master_gad89e839fc17b05fbb5dd79897c55234e}{i2c\+\_\+read\+Nak}} (void)
\begin{DoxyCompactList}\small\item\em read one byte from the I2C device, read is followed by a stop condition \end{DoxyCompactList}\item 
unsigned char \mbox{\hyperlink{group__pfleury__ic2master_ga669c0357614a79b3b35ae815f6f50e82}{i2c\+\_\+read}} (unsigned char ack)
\begin{DoxyCompactList}\small\item\em read one byte from the I2C device \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
I2C (T\+WI) Master Software Library. 


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <i2cmaster.h>} }
\end{DoxyCode}


Basic routines for communicating with I2C slave devices. This single master implementation is limited to one bus master on the I2C bus.

This I2c library is implemented as a compact assembler software implementation of the I2C protocol which runs on any A\+VR (i2cmaster.\+S) and as a T\+WI hardware interface for all A\+VR with built-\/in T\+WI hardware (twimaster.\+c). Since the A\+PI for these two implementations is exactly the same, an application can be linked either against the software I2C implementation or the hardware I2C implementation.

Use 4.\+7k pull-\/up resistor on the S\+DA and S\+CL pin.

Adapt the S\+CL and S\+DA port and pin definitions and eventually the delay routine in the module i2cmaster.\+S to your target when using the software I2C implementation !

Adjust the C\+PU clock frequence F\+\_\+\+C\+PU in twimaster.\+c or in the Makfile when using the T\+WI hardware implementaion.

\begin{DoxyNote}{Note}
The module i2cmaster.\+S is based on the Atmel Application Note A\+V\+R300, corrected and adapted to G\+NU assembler and A\+V\+R-\/\+G\+CC C call interface. Replaced the incorrect quarter period delays found in A\+V\+R300 with half period delays.
\end{DoxyNote}
\begin{DoxyAuthor}{Author}
Peter Fleury \href{mailto:pfleury@gmx.ch}{\texttt{ pfleury@gmx.\+ch}} \href{http://tinyurl.com/peterfleury}{\texttt{ http\+://tinyurl.\+com/peterfleury}} 
\end{DoxyAuthor}
\begin{DoxyCopyright}{Copyright}
(C) 2015 Peter Fleury, G\+NU General Public License Version 3
\end{DoxyCopyright}
\begin{DoxyParagraph}{A\+PI Usage Example}
The following code shows typical usage of this library, see example test\+\_\+i2cmaster.\+c
\end{DoxyParagraph}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <i2cmaster.h>}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{preprocessor}{\#define Dev24C02  0xA2      // device address of EEPROM 24C02, see datasheet}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{int} \mbox{\hyperlink{_master_2main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\{}
\DoxyCodeLine{    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} ret;}
\DoxyCodeLine{}
\DoxyCodeLine{    \mbox{\hyperlink{group__pfleury__ic2master_ga5730d9445429351b9f750084c5cb5aae}{i2c\_init}}();                             \textcolor{comment}{// initialize I2C library}}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// write 0x75 to EEPROM address 5 (Byte Write) }}
\DoxyCodeLine{    \mbox{\hyperlink{group__pfleury__ic2master_gaee3747a01738315cd5580588994b6c28}{i2c\_start\_wait}}(Dev24C02+\mbox{\hyperlink{group__pfleury__ic2master_ga9536bf85bced4f4e549a82fb18eb6140}{I2C\_WRITE}});     \textcolor{comment}{// set device address and write mode}}
\DoxyCodeLine{    \mbox{\hyperlink{group__pfleury__ic2master_gadd947aade44ed6b7f92265f9dec4a711}{i2c\_write}}(0x05);                        \textcolor{comment}{// write address = 5}}
\DoxyCodeLine{    \mbox{\hyperlink{group__pfleury__ic2master_gadd947aade44ed6b7f92265f9dec4a711}{i2c\_write}}(0x75);                        \textcolor{comment}{// write value 0x75 to EEPROM}}
\DoxyCodeLine{    \mbox{\hyperlink{group__pfleury__ic2master_gad35d4e4f52ca74b503d5e5e1e0a3f5f3}{i2c\_stop}}();                             \textcolor{comment}{// set stop conditon = release bus}}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{comment}{// read previously written value back from EEPROM address 5 }}
\DoxyCodeLine{    \mbox{\hyperlink{group__pfleury__ic2master_gaee3747a01738315cd5580588994b6c28}{i2c\_start\_wait}}(Dev24C02+\mbox{\hyperlink{group__pfleury__ic2master_ga9536bf85bced4f4e549a82fb18eb6140}{I2C\_WRITE}});     \textcolor{comment}{// set device address and write mode}}
\DoxyCodeLine{}
\DoxyCodeLine{    \mbox{\hyperlink{group__pfleury__ic2master_gadd947aade44ed6b7f92265f9dec4a711}{i2c\_write}}(0x05);                        \textcolor{comment}{// write address = 5}}
\DoxyCodeLine{    \mbox{\hyperlink{group__pfleury__ic2master_ga93a9461da34295250ba935bbce9a980d}{i2c\_rep\_start}}(Dev24C02+\mbox{\hyperlink{group__pfleury__ic2master_gab5c0fbe837494c5f9130a5914854250d}{I2C\_READ}});       \textcolor{comment}{// set device address and read mode}}
\DoxyCodeLine{}
\DoxyCodeLine{    ret = \mbox{\hyperlink{group__pfleury__ic2master_gad89e839fc17b05fbb5dd79897c55234e}{i2c\_readNak}}();                    \textcolor{comment}{// read one byte from EEPROM}}
\DoxyCodeLine{    \mbox{\hyperlink{group__pfleury__ic2master_gad35d4e4f52ca74b503d5e5e1e0a3f5f3}{i2c\_stop}}();}
\DoxyCodeLine{}
\DoxyCodeLine{    \textcolor{keywordflow}{for}(;;);}
\DoxyCodeLine{\}}
\end{DoxyCode}
 

\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{group__pfleury__ic2master_gab5c0fbe837494c5f9130a5914854250d}\label{group__pfleury__ic2master_gab5c0fbe837494c5f9130a5914854250d}} 
\index{I2C Master library@{I2C Master library}!I2C\_READ@{I2C\_READ}}
\index{I2C\_READ@{I2C\_READ}!I2C Master library@{I2C Master library}}
\doxysubsubsection{\texorpdfstring{I2C\_READ}{I2C\_READ}}
{\footnotesize\ttfamily \#define I2\+C\+\_\+\+R\+E\+AD~1}

defines the data direction (reading from I2C device) in \mbox{\hyperlink{group__pfleury__ic2master_ga58dfadce0c2fee4bfac01df6cd2b4477}{i2c\+\_\+start()}},\mbox{\hyperlink{group__pfleury__ic2master_ga93a9461da34295250ba935bbce9a980d}{i2c\+\_\+rep\+\_\+start()}} 

Definition at line 92 of file I2\+Clibrary.\+h.

\mbox{\Hypertarget{group__pfleury__ic2master_gad33503cf741851d1bca1d274e9001796}\label{group__pfleury__ic2master_gad33503cf741851d1bca1d274e9001796}} 
\index{I2C Master library@{I2C Master library}!i2c\_read@{i2c\_read}}
\index{i2c\_read@{i2c\_read}!I2C Master library@{I2C Master library}}
\doxysubsubsection{\texorpdfstring{i2c\_read}{i2c\_read}}
{\footnotesize\ttfamily \#define i2c\+\_\+read(\begin{DoxyParamCaption}\item[{}]{ack }\end{DoxyParamCaption})~(ack) ? \mbox{\hyperlink{group__pfleury__ic2master_ga32ac22052d55f93375b024192217db21}{i2c\+\_\+read\+Ack}}() \+: \mbox{\hyperlink{group__pfleury__ic2master_gad89e839fc17b05fbb5dd79897c55234e}{i2c\+\_\+read\+Nak}}();}



Definition at line 173 of file I2\+Clibrary.\+h.

\mbox{\Hypertarget{group__pfleury__ic2master_ga9536bf85bced4f4e549a82fb18eb6140}\label{group__pfleury__ic2master_ga9536bf85bced4f4e549a82fb18eb6140}} 
\index{I2C Master library@{I2C Master library}!I2C\_WRITE@{I2C\_WRITE}}
\index{I2C\_WRITE@{I2C\_WRITE}!I2C Master library@{I2C Master library}}
\doxysubsubsection{\texorpdfstring{I2C\_WRITE}{I2C\_WRITE}}
{\footnotesize\ttfamily \#define I2\+C\+\_\+\+W\+R\+I\+TE~0}

defines the data direction (writing to I2C device) in \mbox{\hyperlink{group__pfleury__ic2master_ga58dfadce0c2fee4bfac01df6cd2b4477}{i2c\+\_\+start()}},\mbox{\hyperlink{group__pfleury__ic2master_ga93a9461da34295250ba935bbce9a980d}{i2c\+\_\+rep\+\_\+start()}} 

Definition at line 95 of file I2\+Clibrary.\+h.



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{group__pfleury__ic2master_ga5730d9445429351b9f750084c5cb5aae}\label{group__pfleury__ic2master_ga5730d9445429351b9f750084c5cb5aae}} 
\index{I2C Master library@{I2C Master library}!i2c\_init@{i2c\_init}}
\index{i2c\_init@{i2c\_init}!I2C Master library@{I2C Master library}}
\doxysubsubsection{\texorpdfstring{i2c\_init()}{i2c\_init()}}
{\footnotesize\ttfamily void i2c\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



initialize the I2C master interace. Need to be called only once 

\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}


Definition at line 27 of file I2\+Clibrary.\+c.

\mbox{\Hypertarget{group__pfleury__ic2master_ga669c0357614a79b3b35ae815f6f50e82}\label{group__pfleury__ic2master_ga669c0357614a79b3b35ae815f6f50e82}} 
\index{I2C Master library@{I2C Master library}!i2c\_read@{i2c\_read}}
\index{i2c\_read@{i2c\_read}!I2C Master library@{I2C Master library}}
\doxysubsubsection{\texorpdfstring{i2c\_read()}{i2c\_read()}}
{\footnotesize\ttfamily unsigned char i2c\+\_\+read (\begin{DoxyParamCaption}\item[{unsigned char}]{ack }\end{DoxyParamCaption})}



read one byte from the I2C device 

Implemented as a macro, which calls either \mbox{\hyperlink{group__pfleury__ic2master_ga32ac22052d55f93375b024192217db21}{i2c\+\_\+read\+Ack}} or \mbox{\hyperlink{group__pfleury__ic2master_gad89e839fc17b05fbb5dd79897c55234e}{i2c\+\_\+read\+Nak}}


\begin{DoxyParams}{Parameters}
{\em ack} & 1 send ack, request more data from device~\newline
 0 send nak, read is followed by a stop condition \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
byte read from I2C device 
\end{DoxyReturn}
\mbox{\Hypertarget{group__pfleury__ic2master_ga32ac22052d55f93375b024192217db21}\label{group__pfleury__ic2master_ga32ac22052d55f93375b024192217db21}} 
\index{I2C Master library@{I2C Master library}!i2c\_readAck@{i2c\_readAck}}
\index{i2c\_readAck@{i2c\_readAck}!I2C Master library@{I2C Master library}}
\doxysubsubsection{\texorpdfstring{i2c\_readAck()}{i2c\_readAck()}}
{\footnotesize\ttfamily unsigned char i2c\+\_\+read\+Ack (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



read one byte from the I2C device, request more data from device 

\begin{DoxyReturn}{Returns}
byte read from I2C device 
\end{DoxyReturn}


Definition at line 180 of file I2\+Clibrary.\+c.

\mbox{\Hypertarget{group__pfleury__ic2master_gad89e839fc17b05fbb5dd79897c55234e}\label{group__pfleury__ic2master_gad89e839fc17b05fbb5dd79897c55234e}} 
\index{I2C Master library@{I2C Master library}!i2c\_readNak@{i2c\_readNak}}
\index{i2c\_readNak@{i2c\_readNak}!I2C Master library@{I2C Master library}}
\doxysubsubsection{\texorpdfstring{i2c\_readNak()}{i2c\_readNak()}}
{\footnotesize\ttfamily unsigned char i2c\+\_\+read\+Nak (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



read one byte from the I2C device, read is followed by a stop condition 

\begin{DoxyReturn}{Returns}
byte read from I2C device 
\end{DoxyReturn}


Definition at line 195 of file I2\+Clibrary.\+c.

\mbox{\Hypertarget{group__pfleury__ic2master_ga93a9461da34295250ba935bbce9a980d}\label{group__pfleury__ic2master_ga93a9461da34295250ba935bbce9a980d}} 
\index{I2C Master library@{I2C Master library}!i2c\_rep\_start@{i2c\_rep\_start}}
\index{i2c\_rep\_start@{i2c\_rep\_start}!I2C Master library@{I2C Master library}}
\doxysubsubsection{\texorpdfstring{i2c\_rep\_start()}{i2c\_rep\_start()}}
{\footnotesize\ttfamily unsigned char i2c\+\_\+rep\+\_\+start (\begin{DoxyParamCaption}\item[{unsigned char}]{addr }\end{DoxyParamCaption})}



Issues a repeated start condition and sends address and transfer direction. 


\begin{DoxyParams}{Parameters}
{\em addr} & address and transfer direction of I2C device \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & device accessible \\
\hline
{\em 1} & failed to access device \\
\hline
\end{DoxyRetVals}


Definition at line 128 of file I2\+Clibrary.\+c.

\mbox{\Hypertarget{group__pfleury__ic2master_ga58dfadce0c2fee4bfac01df6cd2b4477}\label{group__pfleury__ic2master_ga58dfadce0c2fee4bfac01df6cd2b4477}} 
\index{I2C Master library@{I2C Master library}!i2c\_start@{i2c\_start}}
\index{i2c\_start@{i2c\_start}!I2C Master library@{I2C Master library}}
\doxysubsubsection{\texorpdfstring{i2c\_start()}{i2c\_start()}}
{\footnotesize\ttfamily unsigned char i2c\+\_\+start (\begin{DoxyParamCaption}\item[{unsigned char}]{addr }\end{DoxyParamCaption})}



Issues a start condition and sends address and transfer direction. 


\begin{DoxyParams}{Parameters}
{\em addr} & address and transfer direction of I2C device \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & device accessible \\
\hline
{\em 1} & failed to access device \\
\hline
\end{DoxyRetVals}


Definition at line 41 of file I2\+Clibrary.\+c.

\mbox{\Hypertarget{group__pfleury__ic2master_gaee3747a01738315cd5580588994b6c28}\label{group__pfleury__ic2master_gaee3747a01738315cd5580588994b6c28}} 
\index{I2C Master library@{I2C Master library}!i2c\_start\_wait@{i2c\_start\_wait}}
\index{i2c\_start\_wait@{i2c\_start\_wait}!I2C Master library@{I2C Master library}}
\doxysubsubsection{\texorpdfstring{i2c\_start\_wait()}{i2c\_start\_wait()}}
{\footnotesize\ttfamily void i2c\+\_\+start\+\_\+wait (\begin{DoxyParamCaption}\item[{unsigned char}]{addr }\end{DoxyParamCaption})}



Issues a start condition and sends address and transfer direction. 

If device is busy, use ack polling to wait until device ready 
\begin{DoxyParams}{Parameters}
{\em addr} & address and transfer direction of I2C device \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}


Definition at line 77 of file I2\+Clibrary.\+c.

\mbox{\Hypertarget{group__pfleury__ic2master_gad35d4e4f52ca74b503d5e5e1e0a3f5f3}\label{group__pfleury__ic2master_gad35d4e4f52ca74b503d5e5e1e0a3f5f3}} 
\index{I2C Master library@{I2C Master library}!i2c\_stop@{i2c\_stop}}
\index{i2c\_stop@{i2c\_stop}!I2C Master library@{I2C Master library}}
\doxysubsubsection{\texorpdfstring{i2c\_stop()}{i2c\_stop()}}
{\footnotesize\ttfamily void i2c\+\_\+stop (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Terminates the data transfer and releases the I2C bus. 

\begin{DoxyReturn}{Returns}
none 
\end{DoxyReturn}


Definition at line 138 of file I2\+Clibrary.\+c.

\mbox{\Hypertarget{group__pfleury__ic2master_gadd947aade44ed6b7f92265f9dec4a711}\label{group__pfleury__ic2master_gadd947aade44ed6b7f92265f9dec4a711}} 
\index{I2C Master library@{I2C Master library}!i2c\_write@{i2c\_write}}
\index{i2c\_write@{i2c\_write}!I2C Master library@{I2C Master library}}
\doxysubsubsection{\texorpdfstring{i2c\_write()}{i2c\_write()}}
{\footnotesize\ttfamily unsigned char i2c\+\_\+write (\begin{DoxyParamCaption}\item[{unsigned char}]{data }\end{DoxyParamCaption})}



Send one byte to I2C device. 


\begin{DoxyParams}{Parameters}
{\em data} & byte to be transfered \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & write successful \\
\hline
{\em 1} & write failed \\
\hline
\end{DoxyRetVals}


Definition at line 156 of file I2\+Clibrary.\+c.

